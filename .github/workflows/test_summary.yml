name: Test Summary Action

on:
  workflow_dispatch:
  workflow_run:
    workflows: [Build]
    types:
      - completed
    branches:
      - summary

jobs:
  test:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Build action
        run: npm run build
        
      - name: Get current date
        id: date
        run: echo "date=$(date -u)" >> $GITHUB_OUTPUT
        
      - name: Basic summary example
        uses: ./
        with:
          content: |
            # üöÄ Basic Summary Example
            
            This is a simple example of using the summary action with a multiline string.
            
            ## üìä Statistics
            
            | Metric | Value |
            | --- | --- |
            | Repository | ${repository} |
            | Branch | ${branch} |
            | Commit | `${commit}` |
            
            ‚úÖ Action test completed!
          variables: |
            {
              "repository": "melMass/actions",
              "branch": "summary",
              "commit": "HEAD"
            }
            
      - name: Template example
        uses: ./
        with:
          template: deployment
          variables: |
            {
              "repository": "melMass/actions",
              "branch": "summary",
              "commit": "HEAD",
              "date": "2025-04-10",
              "author": "melMass",
              "message": "Test commit message",
              "url": "https://example.com/deployment",
              "timestamp": "2025-04-10T02:00:00Z"
            }
          append: "true"
          
      - name: Conditional sections example
        uses: ./
        with:
          content: |
            # üß™ Conditional Sections Example
            
            ## Summary
            
            This example demonstrates conditional sections.
            
            #if(${hasErrors})
            ## ‚ùå Errors
            
            ${errors}
            #endif
            
            #if(${hasWarnings})
            ## ‚ö†Ô∏è Warnings
            
            ${warnings}
            #endif
            
            #if(!${hasErrors} && !${hasWarnings})
            ## ‚úÖ All checks passed!
            
            No errors or warnings were found.
            #endif
          variables: |
            {
              "hasErrors": false,
              "hasWarnings": true,
              "errors": "This would show error details if there were any.",
              "warnings": "- Warning: This is a sample warning message.\n- Warning: Another sample warning."
            }
          append: "true"
